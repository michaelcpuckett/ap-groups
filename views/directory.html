{% from "header.html" import header with context %}
{% from "about.html" import about with context %}

<!doctype html>
<html>
  <title>Directory | chirp.social: groups for the fediverse</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="base.css" />
  <link rel="stylesheet" href="index.css" />
  <style>
    ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    li {
      padding-bottom: 24px;
      border-bottom: 1px solid;
      margin-bottom: 24px;
    }

    @media (min-width: 1200px) {
      .list {
        padding: 32px;
        border-radius: 18px;
        background-color: var(--primary-color);
        color: var(--text-on-primary-color);
      }
    }
  </style>
  <body>
    <div class="root">
      <div class="container">
        {{ header() }}
        
        {% set sortedGroups = groups|sort(true, true, 'followers.totalItems') %}

        <section role="region" aria-labelledby="directory-heading">
          <h2 id="directory-heading">
            Group Directory
          </h2>
          {% if currentUrl === '/directory' %}
            <span>
              Sort by number of members
            </span>
          {% else %}
            <a href="/directory">
              Sort by number of members
            </a>
          {% endif %}
          <br />
          {% if currentUrl === '/directory?sort=recent' %}
            {% set sortedGroups = groups|reverse %}
            <span>
              Sort by recent
            </span>
          {% else %}
            <a href="/directory?sort=recent">
              Sort by recent
            </a>
          {% endif %}
          <br />
          {% if currentUrl === '/directory?sort=posts' %}
            {% set sortedGroups = groups|sort(true, true, 'shared.totalItems') %}
            <span>
              Sort by number of posts
            </span>
          {% else %}
            <a href="/directory?sort=posts">
              Sort by number of posts
            </a>
          {% endif %}
        </section>
        {% for group in sortedGroups %}
          <section class="directory-entry">
            {% if group.icon.url %}
              <a href="{{ group.url }}" style="display: block">
                <img
                  class="avatar"
                  height="100"
                  width="100"
                  src="{{ group.icon.url }}"
                />
              </a>
            {% endif %}
            <a href="{{ group.url }}">
              <strong>
                {{ group.name }}
              </strong>
            </a>
            <dl>
              <dt>
                Handle
              </dt>
              <dd>
                <a href="{{ group.url }}">
                  @{{ group.preferredUsername }}@chirp.social
                </a>
              </dd>
              <dt>
                Bio
              </dt>
              <dd>
                {{ group.summary }}
              </dd>
              <dt>
                Added
              </dt>
              <dd>
                {{ group.published }}
              </dd>
              <dt>
                Members
              </dt>
              <dd>
                {{ group.followers.totalItems }}
              </dd>
              <dt>
                Posts
              </dt>
              <dd>
                {{ group.shared.totalItems }}
              </dd>
            </dl>
          </section>
        {% endfor %}
      </div>
      <div class="right-rail">
        {{ about() }}
      </div>
    </div>
  </body>
</html>