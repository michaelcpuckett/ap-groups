{% from "header.html" import header with context %}
{% from "about.html" import about with context %}

{% if entity.type === 'Collection' or entity.type === 'OrderedCollection' %}
  <!doctype html>
  <html>
    <title>chirp.social - {{ entity.name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <meta name="description" content="{{ group.summary }}" />
    <link rel="stylesheet" href="/base.css" />
    <link rel="stylesheet" href="/index.css" />
    <body>
      <div class="root">
        <div class="container">
          {{ header() }}
          <div role="region">
            <actor-entity entity-id="{{ entity.attributedTo }}"></actor-entity>
            <div class="regions">
              <div class="region">
                <ul>
                  <li>
                    <a href="{{ entity.first }}">First Page</a>
                  </li>
                  <li>
                    <a href="{{ entity.last }}">Last Page</a>
                  </li>
                  <li>
                    <a href="{{ entity.current }}">Current</a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <script type="module" src="/group-entity.js"></script>
        </div>
        <div class="right-rail">
          <header>
            <a href="/directory" class="button button--cta">
              Group Directory
              <span>See All Groups</span>
            </a>
          </header>
          {{ about() }}
        </div>
      </div>
    </body>
  </html>
{% endif %}

{% if entity.type == 'CollectionPage' or entity.type == 'OrderedCollectionPage' %}
  <!doctype html>
  <html>
    <title>chirp.social - {{ entity.name }} - Page {{ entity.page }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <meta name="description" content="{{ group.summary }}" />
    <link rel="stylesheet" href="/base.css" />
    <link rel="stylesheet" href="/index.css" />
    <body>
      <div class="root">
        <div class="container">
          {{ header() }}
          <div role="region">
            {% set items = entity.items %}
            {% if entity.type == 'OrderedCollectionPage' %}
              {% set items = entity.orderedItems %}
            {% endif %}
            <div class="regions">
              {% if items.length %}
                <div class="region">
                  <ul>
                    <li>
                      <a href="{{ entity.first }}">First Page</a>
                    </li>
                    {% if entity.previous %}
                      <li>
                        <a href="{{ entity.previous }}">Previous Page</a>
                      </li>
                    {% endif %}
                    {% if entity.next %}
                      <li>
                        <a href="{{ entity.next }}">Next Page</a>
                      </li>
                    {% endif %}
                    <li>
                      <a href="{{ entity.last }}">Last Page</a>
                    </li>
                    <li>
                      <a href="{{ entity.current }}">Current</a>
                    </li>
                  </ul>
                </div>
                {% if entity.name == 'Shared' %}
                  {% if entity.attributedTo %}
                    <actor-entity entity-id="{{ entity.attributedTo }}"></actor-entity>
                  {% endif %}
                {% endif %}
                <div class="regions">
                  {% for item in items %}
                    {% if item.type == 'Announce' %}
                      <announce-entity entity-id="{{ item.id }}">
                        <!-- Fallback for legacy accounts -->
                        <post-entity entity-id="{{ item.id }}"></post-entity>
                      </announce-entity>
                    {% endif %}
                    {% if item.type == 'Create' and item.object.id and item.object.type === 'Group' %}
                      {% set group = item.object %}
                      <section class="region">
                        {% if group.icon.url %}
                          <a href="{{ group.url }}/shared?page=1&current" style="display: block">
                            <img
                              class="avatar"
                              height="100"
                              width="100"
                              src="{{ group.icon.url }}"
                            />
                          </a>
                        {% endif %}
                        <a href="{{ group.url }}/shared?page=1&current">
                          <strong>
                            {{ group.name }}
                          </strong>
                        </a>
                        <dl>
                          <dt>
                            Handle
                          </dt>
                          <dd>
                            <a href="{{ group.url }}/shared?page=1&current">
                              @{{ group.preferredUsername }}@chirp.social
                            </a>
                          </dd>
                          <dt>
                            Bio
                          </dt>
                          <dd>
                            {{ group.summary }}
                          </dd>
                          {% for attachment in group.attachment %}
                            <dt>
                              {{ attachment.name }}
                            </dt>
                            <dd>
                              {{ attachment.value }}
                            </dd>
                          {% endfor %}
                          <dt>
                            Added
                          </dt>
                          <dd>
                            {{ group.published }}
                          </dd>
                        </dl>
                      </section>
                    {% endif %}
                  {% endfor %}
                  <div class="region">
                    <ul>
                      <li>
                        <a href="{{ entity.first }}">First Page</a>
                      </li>
                      {% if entity.previous %}
                        <li>
                          <a href="{{ entity.previous }}">Previous Page</a>
                        </li>
                      {% endif %}
                      {% if entity.next %}
                        <li>
                          <a href="{{ entity.next }}">Next Page</a>
                        </li>
                      {% endif %}
                      <li>
                        <a href="{{ entity.last }}">Last Page</a>
                      </li>
                      <li>
                        <a href="{{ entity.current }}">Current</a>
                      </li>
                    </ul>
                  </div>
                {% else %}
                  <div class="region">
                    No posts here.
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
          <script type="module" src="/group-entity.js"></script>
        </div>
        <div class="right-rail">
          <header>
            <a href="/directory" class="button button--cta">
              Group Directory
              <span>See All Groups</span>
            </a>
          </header>
          {{ about() }}
        </div>
      </div>
    </body>
  </html>
{% endif %}

{% if entity.type === 'Group' %}
  {% if entity.streams %}
    {% for stream in entity.streams %}
      {% if stream === (entity.url + '/shared') %}
      <!doctype html>
        <html>
          <title>@{{ entity.preferredUsername }}@chirp.social</title>
          <meta name="viewport" content="width=device-width, initial-scale=1" />
          <meta charset="utf-8" />
          <meta name="description" content="{{ group.summary }}" />
          <link rel="stylesheet" href="base.css" />
          <link rel="stylesheet" href="index.css" />
          <body>
            <div class="root">
              <div class="container">
                {{ header() }}
                <section role="region">
                  <h1>
                    {% if entity.name %}
                      {{ entity.name }}
                    {% else %}
                      {{ entity.preferredUsername }}
                    {% endif %}
                  </h1>
                  <div class="avatar-summary">
                    {% if entity.icon %}
                      <img
                        class="avatar"
                        height="100"
                        width="100"
                        src="{{ entity.icon.url }}"
                      />
                    {% endif %}
                    <div>
                      <p>
                        <strong>
                          @{{ entity.preferredUsername }}@chirp.social
                        </strong>
                      </p>
                      {% if entity.summary %}
                      {% endif %}
                        <dl>
                          <dt>
                            Group Summary
                          </dt>
                          <dd>
                            {{ entity.summary }}
                          </dd>
                          {% for attachment in entity.attachment %}
                            <dt>
                              {{ attachment.name }}
                            </dt>
                            <dd>
                              {{ attachment.value }}
                            </dd>
                          {% endfor %}
                          <dt>
                            Followers
                          </dt>
                          <dd>
                            {{ followersCount }}
                          </dd>
                          <dt>
                            <a href="{{ stream }}?current&page=1">
                              Posts
                            </a>
                          </dt>
                          <dd>
                            <a href="{{ stream }}?current&page=1">
                              {{ shared.length }}
                            </a>
                          </dd>
                        </dl>
                    </div>
                  </div>
                </section>
                <script type="module" src="group-entity.js"></script>
              </div>
              <div class="right-rail">
                <header>
                  <a href="/directory" class="button button--cta">
                    Group Directory
                    <span>See All Groups</span>
                  </a>
                </header>
                {{ about() }}
              </div>
            </div>
          </body>
        </html>
      {% endif %}
    {% endfor %}
  {% endif %}
{% endif %}