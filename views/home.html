{% from "header.html" import header with context %}

<!doctype html>
<html>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="utf-8" />
  <link rel="stylesheet" href="base.css" />
  <link rel="stylesheet" href="index.css" />
  <link rel="stylesheet" href="home.css" />
  <body>
    <div>
      <div class="root">
        <div class="container">
          {{  header()  }}
        </div>
        <div class="right-rail">
        </div>
      </div>
      <div class="root">
        <div class="container">
          <section>
            <h1>
              Managing 
              @{{ actor.preferredUsername }}@chirp.social
            </h1>
          </section>

          <section>
            <details open>
              <summary>
                Edit Profile
              </summary>
              <group-details
                group-actor-id="{{ actor.id }}"
                followers-url="{{ actor.followers }}"
                outbox-url="{{ actor.outbox.url }}"
                upload-media-url="{{ actor.endpoints.uploadMedia }}"
                {% if actor.attachment %}
                  {% for attachment in actor.attachment %}
                    {% if attachment.name == 'Group Manager' %}
                      manager="{{ attachment.value }}"
                    {% elif attachment.name == 'Group Rules' %}
                      rules="{{ attachment.value }}"
                    {% endif %}
                  {% endfor %}
                {% endif %}
                {% if actor.manuallyApprovesFollowers %}
                  manually-approves-followers
                {% endif %}
                {% if actor.sensitive %}
                  sensitive
                {% endif %}
                icon="{{ actor.icon | dump }}"
                name="{{ actor.name }}"
                summary="{{ actor.summary }}">
              </group-details>
            </details>
          </section>

          <section>
            <details open>
              <summary>
                Post as the Group
              </summary>
              <post-form
                group-actor-id="{{ actor.id }}"
                followers-url="{{ actor.followers }}"
                outbox-url="{{ actor.outbox.url }}">
              </post-form>
            </details>
          </section>

          <section>
            <details open>
              <summary>
                Outbox ({{ actor.outbox.totalItems }})
              </summary>
              <div class="regions">
                {% if actor.outbox.orderedItems.length %}
                  {% for post in actor.outbox.orderedItems %}
                    <div class="region">
                      <announce-entity
                        entity-id="{{ post }}"
                        actor-id="{{ actor.id }}"
                        undo-action>
                      </announce-entity>
                    </div>
                  {% endfor %}
                {% else %}
                  <p>
                    No posts yet.
                  </p>
                {% endif %}
              </div>
            </details>
          </section>
        </div>

        <div class="right-rail">
          <section>
            <button
              data-action="logout"
              type="button"
              class="button"
              id="logout-button">
              Log Out
            </button>
          </section>

          <section>
            <details>
              <summary>
                Follower Requests ({{ requests.length }})
              </summary>
              {% if requests.length %}
                <ul>
                  {% for request in requests %}
                    <li>
                      <request-entity
                        entity-id="{{ request }}"
                        actor-id="{{ actor.id }}"
                        accept-action
                        ignore-action
                        block-action>
                      </request-entity>
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <p>
                  No follower requests.
                </p>
              {% endif %}
            </details>
          </section>

          <section>
            {% if members.length %}
              <details>
            {% else %}
              <details open>
            {% endif %}
              <summary>
                Members ({{ members.length }})
              </summary>
              {% if members.length %}
                <ul>
                  {% for member in members %}
                    <li>
                      <actor-entity
                        entity-id="{{ member }}"
                        actor-id="{{ actor.id }}"
                        block-action>
                      </actor-entity>
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <p>
                  You have no members following the group.
                  To get started, go to your personal Mastodon
                  account and search for
                  <strong>@{{ actor.preferredUsername }}@chirp.social</strong>
                  then follow it.
                </p>
              {% endif %}
            </details>
          </section>

          <section>
            <details>
              <summary>
                Blocked ({{ blocks.length }})
              </summary>
              {% if blocks.length %}
                <ul>
                  {% for block in blocks %}
                    <li>
                      <block-entity
                        entity-id="{{ block }}"
                        actor-id="{{ actor.id }}"
                        unblock-action>
                      </block-entity>
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <p>
                  No one is blocked.
                </p>
              {% endif %}
            </details>
          </section>

          <section>
            <details>
              <summary>
                Delete Group
              </summary>
              <div>
                <button
                  data-action="delete"
                  data-id="{{ actor.id }}"
                  type="button"
                  class="button button--tag">
                  Delete Group
                </button>
              </div>
            </details>
          </section>
        </div>
      </div>
    </div>
    <script type="module" src="home.js"></script>
  </body>
</html>